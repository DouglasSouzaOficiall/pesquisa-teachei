<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teachei Zap - Pesquisa de Campo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --green: #34C759; --dark: #000; }
        body { font-family: 'Inter', sans-serif; background-color: #fff; margin: 0; padding: 0; }
        .header-teachei { background-color: var(--green); width: 100%; padding: 40px 0; display: flex; justify-content: center; align-items: center; margin-bottom: 20px; }
        .logo-img { max-height: 100px; width: auto; }
        .container-app { max-width: 420px; margin: 0 auto; padding: 20px; text-align: center; }
        h2 { font-weight: 900; margin: 30px 0; font-size: 1.4rem; color: #333; line-height: 1.3; }
        .step { display: none; }
        .step.active { display: block; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .input-teachei { width: 100%; border: none; border-bottom: 2px solid #333; padding: 12px; font-size: 1.1rem; margin-bottom: 25px; outline: none; text-align: center; background: transparent; }
        .card-option { background: #F8F8F8; border: 1px solid #EEE; border-radius: 12px; padding: 18px; margin-bottom: 12px; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .card-option.selected { background: var(--green); color: white; border-color: var(--green); }
        .badge-prof { background: #E8F9EE; color: var(--green); padding: 6px 15px; border-radius: 20px; font-size: 0.75rem; font-weight: 900; display: inline-block; margin-bottom: 15px; }
        .btn-teachei { background: var(--green); color: white; border: none; border-radius: 10px; padding: 18px; width: 100%; font-weight: 900; font-size: 1.1rem; }
        .btn-back { background: none; border: none; color: #8E8E93; font-weight: 600; margin-top: 20px; }
        .success-icon { font-size: 50px; color: var(--green); margin-bottom: 20px; }
    </style>
</head>
<body>
    <header class="header-teachei">
        <img src="logo.png" class="logo-img">
    </header>

    <div class="container-app">
        <form id="formTeachei">
            <div class="step active" id="s1">
                <h2>Nome completo?</h2>
                <input type="text" id="nome" class="input-teachei" placeholder="Nome e sobrenome" required>
                <button type="button" class="btn-teachei" onclick="go(2)">PRÓXIMO</button>
            </div>
            <div class="step" id="s2">
                <h2>Idade?</h2>
                <input type="number" id="idade" class="input-teachei" placeholder="Sua idade" required>
                <button type="button" class="btn-teachei" onclick="go(3)">PRÓXIMO</button>
                <button type="button" class="btn-back" onclick="go(1)">VOLTAR</button>
            </div>
            <div class="step" id="s3">
                <h2>Whatsapp com DDD?</h2>
                <input type="tel" id="whatsapp" class="input-teachei" placeholder="(00) 00000-0000" required>
                <button type="button" class="btn-teachei" onclick="go(4)">PRÓXIMO</button>
                <button type="button" class="btn-back" onclick="go(2)">VOLTAR</button>
            </div>
            <div class="step" id="s4">
                <h2>Você sente que é difícil achar rápido o contato de profissionais ou serviços locais (ex: um chaveiro, alguém que limpe piscina ou venda pão caseiro)?</h2>
                <div class="card-option" onclick="select(this, 'p1', 'Sim')">SIM, É DIFÍCIL</div>
                <div class="card-option" onclick="select(this, 'p1', 'Não')">NÃO, ACHO FÁCIL</div>
                <input type="hidden" id="p1">
                <button type="button" class="btn-teachei mt-3" onclick="go(5)">PRÓXIMO</button>
                <button type="button" class="btn-back" onclick="go(3)">VOLTAR</button>
            </div>
            <div class="step" id="s5">
                <h2>Qual meio que você usa hoje para procurar essas pessoas?</h2>
                <div class="card-option" onclick="select(this, 'p2', 'Google')">GOOGLE</div>
                <div class="card-option" onclick="select(this, 'p2', 'Facebook')">FACEBOOK</div>
                <div class="card-option" onclick="select(this, 'p2', 'Instagram')">INSTAGRAM</div>
                <div class="card-option" onclick="select(this, 'p2', 'Whatsapp')">GRUPOS DE WHATSAPP</div>
                <input type="hidden" id="p2">
                <button type="button" class="btn-teachei mt-3" onclick="go(6)">PRÓXIMO</button>
                <button type="button" class="btn-back" onclick="go(4)">VOLTAR</button>
            </div>
            <div class="step" id="s6">
                <h2>Se você tivesse no celular um contato que te ajudasse em todas as demandas, usaria com que frequência (de graça)?</h2>
                <div class="card-option" onclick="select(this, 'p3', 'Todos os dias')">TODOS OS DIAS</div>
                <div class="card-option" onclick="select(this, 'p3', 'Uma vez por semana')">UMA VEZ POR SEMANA</div>
                <div class="card-option" onclick="select(this, 'p3', '1 vez por mês')">1 VEZ POR MÊS</div>
                <input type="hidden" id="p3">
                <button type="button" class="btn-teachei mt-3" onclick="go(7)">PRÓXIMO</button>
                <button type="button" class="btn-back" onclick="go(5)">VOLTAR</button>
            </div>
            <div class="step" id="s7">
                <span class="badge-prof">ANUNCIANTE</span>
                <h2>Qual sua profissão?</h2>
                <input type="text" id="p4" class="input-teachei" placeholder="Sua profissão" required>
                <button type="button" class="btn-teachei" onclick="go(8)">PRÓXIMO</button>
                <button type="button" class="btn-back" onclick="go(6)">VOLTAR</button>
            </div>
            <div class="step" id="s8">
                <span class="badge-prof">ANUNCIANTE</span>
                <h2>Você tem alguma profissão paralela que poderia ganhar um dinheiro extra?</h2>
                <div class="card-option" onclick="select(this, 'p5', 'Sim')">SIM</div>
                <div class="card-option" onclick="select(this, 'p5', 'Não')">NÃO</div>
                <input type="hidden" id="p5">
                <button type="button" class="btn-teachei mt-3" onclick="go(9)">PRÓXIMO</button>
                <button type="button" class="btn-back" onclick="go(7)">VOLTAR</button>
            </div>
            <div class="step" id="s9">
                <span class="badge-prof">OFERTA</span>
                <h2>Pagaria R$ 24,90 por 3 meses (R$ 8,30/mês) para estar em uma lista que a cidade toda veria?</h2>
                <div class="card-option" onclick="select(this, 'p6', 'Sim')">SIM</div>
                <div class="card-option" onclick="select(this, 'p6', 'Não')">NÃO</div>
                <input type="hidden" id="p6">
                <button type="submit" id="btnFinal" class="btn-teachei mt-4" style="background-color: #000;">ENVIAR PESQUISA</button>
                <button type="button" class="btn-back" onclick="go(8)">VOLTAR</button>
            </div>
            <div class="step" id="sSuccess">
                <div class="success-icon">✔</div>
                <h2>Pesquisa enviada!</h2>
                <p>Dados gravados com sucesso.</p>
                <button type="button" class="btn-teachei mt-4" onclick="location.reload()">NOVA PESQUISA</button>
            </div>
        </form>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyAhEpxGDQihla_rxkpxG3Pggeh51fvxdPY",
            authDomain: "teachei-pesquisa.firebaseapp.com",
            projectId: "teachei-pesquisa",
            storageBucket: "teachei-pesquisa.firebasestorage.app",
            messagingSenderId: "113171078649",
            appId: "1:113171078649:web:e1d7c7ebad614fd4c47128"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const alertError = (msg) => Swal.fire({ icon: 'error', title: 'Atenção', text: msg, confirmButtonColor: '#34C759' });

        window.go = (n) => {
            // VALIDAÇÃO NOME COMPLETO (Nome + Sobrenome)
            if (n === 2) {
                const nomeInput = document.getElementById('nome').value.trim();
                const partesNome = nomeInput.split(" ");
                if (partesNome.length < 2 || partesNome[1] === "") {
                    return alertError("Por favor, digite seu nome completo (nome e sobrenome).");
                }
            }
            if (n === 3) {
                const idade = document.getElementById('idade').value;
                if (!idade) return alertError("Informe sua idade.");
                if (idade < 18) return alertError("Você precisa ter mais de 18 anos para continuar.");
            }
            if (n === 4 && !document.getElementById('whatsapp').value) return alertError("Informe seu Whatsapp.");
            if (n === 5 && !document.getElementById('p1').value) return alertError("Selecione uma opção.");
            if (n === 6 && !document.getElementById('p2').value) return alertError("Selecione uma opção.");
            if (n === 7 && !document.getElementById('p3').value) return alertError("Selecione uma opção.");
            if (n === 8 && !document.getElementById('p4').value) return alertError("Informe sua profissão.");
            if (n === 9 && !document.getElementById('p5').value) return alertError("Selecione uma opção.");

            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('s' + n).classList.add('active');
            window.scrollTo(0, 0);
        };

        window.select = (el, id, val) => {
            el.parentElement.querySelectorAll('.card-option').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById(id).value = val;
        };

        document.getElementById('formTeachei').onsubmit = async (e) => {
            e.preventDefault();
            const zap = document.getElementById('whatsapp').value;
            if (!document.getElementById('p6').value) return alertError("Responda a última pergunta.");

            const btn = document.getElementById('btnFinal');
            btn.innerText = "VALIDANDO...";
            btn.disabled = true;

            try {
                const q = query(collection(db, "respostas"), where("whatsapp", "==", zap));
                const snap = await getDocs(q);
                if (!snap.empty) {
                    btn.disabled = false;
                    btn.innerText = "ENVIAR PESQUISA";
                    return alertError("Este número já participou da pesquisa.");
                }

                await addDoc(collection(db, "respostas"), {
                    nome: document.getElementById('nome').value.trim(),
                    idade: document.getElementById('idade').value,
                    whatsapp: zap,
                    p1: document.getElementById('p1').value,
                    p2: document.getElementById('p2').value,
                    p3: document.getElementById('p3').value,
                    p4: document.getElementById('p4').value,
                    p5: document.getElementById('p5').value,
                    p6: document.getElementById('p6').value,
                    data: new Date().toLocaleString("pt-BR")
                });
                document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
                document.getElementById('sSuccess').classList.add('active');
            } catch (error) {
                alertError("Erro ao salvar. Tente novamente.");
                btn.disabled = false;
                btn.innerText = "ENVIAR PESQUISA";
            }
        };
    </script>
</body>
</html>

